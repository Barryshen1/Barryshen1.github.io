{% if site.chatbot.enabled %}
{% include base_path %}
{% assign avatar_name = site.author.name | default: "Research Bot" %}
{% assign assistant_title = site.chatbot.title | default: avatar_name %}
{% assign assistant_initial = avatar_name | slice: 0, 1 | upcase %}
{% assign avatar_file = site.author.avatar | default: "profile.png" %}
{% if avatar_file contains "http" %}
  {% assign assistant_avatar = avatar_file %}
{% else %}
  {% assign assistant_avatar = base_path | append: "/images/" | append: avatar_file %}
{% endif %}

<div
  class="chatbot"
  data-chatbot
  data-endpoint="{{ site.chatbot.endpoint | strip | escape }}"
  data-title="{{ assistant_title | escape }}"
  data-welcome="{{ site.chatbot.welcome | escape }}"
  data-disclaimer="{{ site.chatbot.disclaimer | escape }}"
  data-assistant-name="{{ avatar_name | escape }}"
  data-assistant-initials="{{ assistant_initial | escape }}"
  data-assistant-avatar="{{ assistant_avatar | escape }}">

  <button
    class="chatbot__peek"
    type="button"
    aria-expanded="false"
    aria-controls="chatbot-panel"
    data-chatbot-open>
    <span class="chatbot__peek-avatar" aria-hidden="true">
      <img src="{{ assistant_avatar }}" alt="" loading="lazy" />
      <span class="chatbot__peek-initials">{{ assistant_initial }}</span>
    </span>
    <span class="chatbot__peek-copy">
      <strong>{{ assistant_title }}</strong>
      <span>Quick answers about my work</span>
    </span>
    <span class="chatbot__peek-indicator">Chat</span>
  </button>

    <section class="chatbot__panel" id="chatbot-panel" role="dialog" aria-label="{{ assistant_title }}" hidden>
      <header class="chatbot__header">
        <div class="chatbot__header-main">
          <div class="chatbot__avatar" aria-hidden="true">
            <img src="{{ assistant_avatar }}" alt="" loading="lazy" />
            <span>{{ assistant_initial }}</span>
          </div>
          <div>
            <p class="chatbot__title">{{ assistant_title }}</p>
          </div>
        </div>
        <div class="chatbot__header-actions">
          <span class="chatbot__status-dot" aria-hidden="true"></span>
          <button class="chatbot__icon-btn" type="button" data-chatbot-close aria-label="Close chat">x</button>
        </div>
      </header>

      <div class="chatbot__body">
        <div class="chatbot__messages" aria-live="polite"></div>

      <div class="chatbot__footer">
        <label for="chatbot-input" class="screen-reader-text">Message</label>
        <textarea
          id="chatbot-input"
          class="chatbot__input"
          rows="3"
          placeholder="Ask about publications, research, or teaching..."
          data-chatbot-input></textarea>

        <div class="chatbot__footer-actions">
          <button class="chatbot__btn" type="button" data-chatbot-reset>Reset</button>
          <div class="chatbot__footer-right">
            <span class="chatbot__badge">Vertex AI</span>
            <button class="chatbot__btn chatbot__btn--primary" type="button" data-chatbot-send>
              Send
            </button>
          </div>
        </div>
        <div class="chatbot__status" data-chatbot-status>{{ site.chatbot.disclaimer }}</div>
      </div>
    </div>
  </section>
</div>
{% endif %}
